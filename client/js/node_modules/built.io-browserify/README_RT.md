# Quick Overview  
    
## Intro  
This document covers the details of JavaScript based SDK provided by built.io. The SDK is available both for Browser and Node.js environments.  

## Installation <a name="installation"></a>

### Node.js
  To use this SDK on Node.js follow the below given steps.

  * Download the buit.io SDK from npm repository.

          npm install built.io
  * Require the SDK module in your application.

          var Built = require('built.io'); 

### Browser
  To use this SDK on browser follow the below given steps.

  * Download the SDK package from [here](./built.min.zip "SDK").

  * Extract the zip package to get the **built.min.js** file and include it in a script tag as shown below.

          <script type="text/javascript" src="built.min.js"></script>

  * After the file is included a **Built** object would be avaliable globally for use as shown below.

          var app = Built.App('api_key');

## Basic structure

  The structure followed by SDK logically resembles the application structure on built.io. Once you're done with the basic setup explained in [Installation](#installation) section, you have a Built object with you, which you can then use to initialize different modules.

  Initialization process for each module is explained briefly below.

  * ### Application

    To initialize an app, use the App constructor on the Built object and supply it the application's api key.

            var app = Built.App('api_key');
 
  * ### Class

    An application can have multiple classes. Similarly, an application instance has a class constructor which accepts the uid of the class whose instance is to be created.

            var PersonClass = app.Class('person');               

  * ### Object

    Object is an instance of a Class. SDK follows this by providing a 'Object' constructor on the class instance. The object constructor accepts an existing object's uid or data to initialize a new object.

          var Person = PersonClass.Object;
          var person = Person({
            name : 'Abc'
          });

  * ### Query

    Query is used to retrieve objects of class based on some condition. SDK provides a Query constructor on the class instance which when executed would retrieve objects of that class.

          var query = PersonClass.Query();

  * ### Upload
    
    The Upload constructor can be accessed on the App instance.

          var upload = app.Upload();

## Cache Policies
  
  SDK supports caching and uses browsers 'localStorage' to maintain it. A set of cache policies are avaliable for use which are listed below.

  * ##### ONLY_NETWORK (Default)
    This is the default cache policy which will always get the data from an network call.

  * ##### CACHE_ELSE_NETWORK
    This policy will try to first get the data from cache, on failure would make a network call.

  * ##### NETWORK_ELSE_CACHE
    It will try to make a network call, on failure would fetch it from cache.

  * ##### CACHE_THEN_NETWORK
    This policy would first get the data from cache as well would make a network call to get the updated copy.

  Cache policy can be set for the entire application as follows, which means all queries built using this application instance would follow the cache policy.

          var app = Built.App('api_key').setCachePolicy(Built.CachePolicy.CACHE_ELSE_NETWORK);

  Cache policy can also be set on individual queries as follows.

          var query   = Built.App('api_key').Class('person').Query();
          query       = query.setCachePolicy(Built.CachePolicy.CACHE_ELSE_NETWORK);

## Transforms

  Transforms allows you to get the objects returned from a query in format other than the default. For example, you can choose to get a Backbone.js collection instead of an array of objects.

  The transforms avaliable are listed below.

  * #### toJSON()
    
  This transform would return the query result as an array of plain javascript objects

          var query   = Built.App('api_key').Class('person').Query();
          query
            .where('name','abc')
            .toJSON()
            .exec()
            .then(function(objects){
                console.log(objects); // array of plain javascript objects
            });

  * #### toBackbone()

  This transform would return the query result as a Backbone.js collection

          var query   = Built.App('api_key').Class('person').Query();
          query
            .where('name','abc')
            .toBackbone()
            .exec()
            .then(function(collection){
                console.log(collection); // Backbone.js collection
            });

## Immutability

  The SDK follows the concept of immutability. This means any operation that intends to modify the state of an object results into the creation of a new object with the intended modification. The state of the existing object is maintained.

  The advantages of immutability are explained below.

1] Suppose you want to upload 3 files on built.io and all of them share the same ACL. The code for this is simplified because of immutability.

  * Create an ACL object with the intended permission.

            var acl     = Built.ACL();
            acl         = acl.setPublicReadAccess(true); // Returns a new ACL object with read permission

  * Create an upload object and apply ACL to it.

            var upload = Built.App('api_key').Upload() 
                          .setACL(acl);   // Returns a new upload object with public read access.

  * We can now create multiple uploads using the existing upload object.

            var upload1 = upload.setFile('/home/abc/Pictures/tiger.gif');

            var upload2 = upload.setFile('/home/abc/Pictures/duck.gif');

            var upload3 = upload.setFile('/home/abc/Pictures/dolphin.gif');

2] Suppose you want create two app instances which are exactly similar to each other but belong to different tenants. The code for this is simplified because of immutability.

            var app   = Built.App('api_key')
                        .setCachePolicy(Built.CachePolicy.CACHE_ELSE_NETWORK);

            var app1  = app.setTenant('abc'); 

            var app2  = app.setTenant('xyz');



## Promises

  SDK uses promises for handling all of its async operations. Few examples are shown below.

  * ### Saving an object

    To save an object on built.io is an async task, therefore the save() method returns a promise which resolves with saved object.

          Person({             // Person is object constructor
            name : 'Abc'
          })
          .save()
          .then(function(object){
            // object returned from built.io
          });

  * ### Executing a query

    Executing a query on built.io is also an async task, therefore exec() method returns a promise which resolves with all the objects which fulfils the query condition.

        PersonClass
          .Query()
          .where('name','abc')
          .exec()
          .then(function(objects){
            // All persons having name as 'abc'
          });

## Realtime Functionality

  Applications like chat, sock updates, alarm system require data to be fetched and pushed to and forth from the server in seconds. To support these kind of requirements built.io provides realtime functionality. In this a socket connection is being established between the client and server which speeds up the communication between the two.

   * ### Usage
    To use realtime based SDK follow the below given steps.

      * Download the SDK package from [here](./built_rt.min.zip "SDK with realtime").

      * Extract the zip package to get the **built_rt.min.js** file and include it in a script tag as shown below.

          <script type="text/javascript" src="built_rt.min.js"></script>

      * After the file is included we can create an *app* instance which is realtime enabled as shown below.

              var app = Built.App('api_key').enableRealtime();

   * ### API

   built.io uses events to notify the user when a particular action was performed. To be able to listen to these events, we must setup event listeners.

    SDK provides various handy functions to use realtime functionality each of which is explained in details below.

    * ### on <a name="on"></a>

      This function is avaliable on constructors as well as instance. It takes two arguments, first the event on which we would like to listen too and secondly the listener to be invoked when the event is triggered. Below is a example where we setup a listener on Object constructor and its instance. Setuping a listener on instance requires a read permission on it. (Refer actual documentation for a more detailed explaination)

            var app    = Built.App('api_key').enableRealtime();

            var Person = app.Class('person').Object; // Object constructor

            var person = Person('uid'); // Person instance

            Person.on('update',updateCB);

            person.on('update',updateCB);   

            function updateCB(person){
              console.log(person.toJSON()); // updated object
            }

  * ### off

      As the name suggest this method should be used to turn off a listener from listening to event notifications. Similar to [on( )](#on) function it takes two arguements both of which are optional.

      1. A specific listener could be turned off as shown below.

              var app    = Built.App('api_key').enableRealtime();

              var Person = app.Class('person').Object; // Object constructor

              Person.on('update', updateCB);

              Person.on('create', updateCB);

              Person.off('update',updateCB); //turns off listener for update only

              function updateCB(person){
                  console.log(person.toJSON()); // updated object
              }

      2. All listeners attached to a resource could be removed as shown below.

              var app    = Built.App('api_key').enableRealtime();

              var Person = app.Class('person').Object; // Object constructor

              Person.on('update', updateCB);

              Person.on('create', updateCB);

              Person.off(); //turns off all listener attached on Person

              function updateCB(person){
                  console.log(person.toJSON()); // updated object
              }
      3. All listeners attached for a given event on a resource coule be removed as shown below.

              var app    = Built.App('api_key').enableRealtime();

              var Person = app.Class('person').Object; // Object constructor

              Person.on('update', printJSON);

              Person.on('update', printObject);

              Person.on('create', printJSON);

              Person.off('update');       //turns off all listener attached on Person for update event.

              function printJSON(person){
                  console.log(person.toJSON()); // updated object
              }

              function printObject(person){
                  console.log(person); // updated object
              }


  * ### broadcast

    built.io allows you to broadcast message that could be listened by others by setting up listeners for it. Broadcast method should be used to broadcast message and is avaliable on constructors as well as instance. Update permission is required on the resource to be able to broadbast a message. Example below demonstrates the syntax.

          // Broadcastor
          var app    = Built.App('api_key').enableRealtime();

          var Person = app.Class('person').Object; // Object constructor

          Person.broadcast('Hello built.io');

          //Subscriber

          var app    = Built.App('api_key').enableRealtime();

          var Person = app.Class('person').Object; // Object constructor

          Person.on('broadcast',function(message){
            console.log(message);
          });

* ### Presence

    Presence is a feature that allows you to detect if a certain application user is currently online or offline. It stores the "last seen" timestamp of the user which is useful in chat applications. Additionally, it allows you to store a "state" associated with your profile (you could use it to store chat statuses, for example).

    List of handy function provided to deal with presence feature are listed below.

    * ### getPresence

    1] To get currently logged-in user's presence details SDK provides getPresence() on User constructor, which returns a promise which eventually resolves with instance of presence module.(Refer actual documentation for details about presence module).

            // Assuming user has already logged-in
            var app  = Built.App('api_key').enableRealtime();
            var User = app.User;
            User
              .getPresence() 
              .then(function(presence){
                console.log(presence.toJSON());
                // modifying the user's presence to be accesible publicly.
                presence
                  .setPublic(true)
                  .save()
                    .then(function(presence){
                      console.log(presence);
                    });
              });

   2] To get presence details of some other application user, SDK provides getPresence method on user instance. 

   Example below demonstrates the syntax.

            var app  = Built.App('api_key').enableRealtime();
            var user = app.User('uid');
            user
              .getPresence()
              .then(function(presence){
                console.log(presence.toJSON());
              });
              
          //You would be able access presence details of someone else only if he has set his presence details to be publicly avaliable or has shared it with you, by adding you in his whitelist.

    * ### requestPresenceAccess

    In many chat applications, you can also request another user for access to their presence.We provide a similar functionality with requestPresence function. You can request a certain user for access to his presence.

    Example below demonstrates the syntax.

            var app  = Built.App('api_key').enableRealtime();
            var user = app.User('uid');
            user
            .requestPresenceAccess()
            .then(function(){
              // done
            });




